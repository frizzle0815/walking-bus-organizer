services:
  db:
    image: postgres:15
    environment:
      - POSTGRES_USER=walkingbus
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=walkingbus
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U walkingbus"]
      interval: 5s
      timeout: 5s
      retries: 5

  web:
    build: .
    ports:
      - "8000:8000"
    depends_on:
      db:
        condition: service_healthy
    environment:
      - DATABASE_URL=postgresql://walkingbus:password@db:5432/walkingbus
      - FLASK_ENV=production
      - HOLIDAY_COUNTRY=DE
      - HOLIDAY_SUBDIVISION=NW
      - SECRET_KEY=f6fa3a41090da814c763a0d8b8d3231ed72e264d9a832a2f1fd2d51b39da5581eff643a48426de49900f11514c49fb843428d6d963979891f780b6566e4da46f11862e22b1d2f1160b36cfe91acb0a0852f4879327c90ee2e9d28611a3b0530f4e6176e8b3bab9e40ecb098441a2aa7c765b09006f42f02ce3f916cf7aee3dcd683506826d045ba0ac4cf5e4a380c71eb71cc494348e819e6519c36e67fdc1a1d72393ea48b41da9b8b79590f472efb75cdfa4f89978105bc7dc0581b37ea8a65b025010e8b2aa64d5ef862cdd2e3202861cbb0e658cf4146ecdb11460d0ffcde2e675d5deb8b17b1338f111c7a3a066aa0660dc49f6cd7a8c16a2f5667bfd2b  # 
      - APP_PASSWORD=IhrGemeinsamesPasswort

volumes:
  postgres_data:
